import{r as y,g as b,i as k,j as i,c as o,B as V,N as D,Q as N,h as M,a as f,p as A,n as L,k as P,x as S,F as O,R as p,t as $,d as h,U as j,W as C,X as E,Y as T,Z as B,_}from"./index-2daf20c7.js";const w={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PluginSettingsView_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{args:null,kind:"FragmentSpread",name:"UpdatePluginButton_pluginInstallation"}],type:"PluginInstallation",abstractKey:null};w.hash="67f79a352a26070e5e09d7779cbd1693";const F=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"uninstallPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUninstallPluginMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUninstallPluginMutation",selections:n},params:{cacheID:"3a8a65cc7d44dc0f5ebc9b34a42765cb",id:null,metadata:{},name:"PluginSettingsViewUninstallPluginMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUninstallPluginMutation(
  $input: MutationUninstallPluginInput!
) {
  uninstallPlugin(input: $input) {
    slug
  }
}
`}}}();F.hash="2cbb01b9fde710cf5586414364e23623";const x=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"where"}],n=[{alias:null,args:[{kind:"Variable",name:"where",variableName:"where"}],concreteType:"Store",kind:"LinkedField",name:"storeItems",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewQuery",selections:n,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewQuery",selections:n},params:{cacheID:"4457517258b897202b36e860b504742f",id:null,metadata:{},name:"PluginSettingsViewQuery",operationKind:"query",text:`query PluginSettingsViewQuery(
  $where: QueryStoreItemsInput!
) {
  storeItems(where: $where) {
    id
    updatedAt
    key
    value
    pluginSlug
    isSecret
    isServerOnly
  }
}
`}}}();x.hash="50fe46f4df785eec0286be0cdb0e79d3";const U=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:n,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"PluginSettingsViewStoreItem_item"}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:n,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}]},params:{cacheID:"ac99ed281b52dedb236cfd3cbf578c13",id:null,metadata:{},name:"PluginSettingsViewUpdatePluginSettingsMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUpdatePluginSettingsMutation(
  $input: MutationUpsertStoreItemInput!
) {
  upsertStoreItem(input: $input) {
    ...PluginSettingsViewStoreItem_item
    id
  }
}

fragment PluginSettingsViewStoreItem_item on Store {
  id
  updatedAt
  key
  value
  pluginSlug
  isSecret
  isServerOnly
}
`}}}();U.hash="6220986d895d0d9050d5577a61064ded";const I={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UpdatePluginButton_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"PluginInstallation",abstractKey:null};I.hash="4f1184aecaeea8735d4c8df05106bcd6";const K=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"installPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UpdatePluginButtonUpdatePluginMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UpdatePluginButtonUpdatePluginMutation",selections:n},params:{cacheID:"c510b96612a525835fd97692b2f99e5c",id:null,metadata:{},name:"UpdatePluginButtonUpdatePluginMutation",operationKind:"mutation",text:`mutation UpdatePluginButtonUpdatePluginMutation(
  $input: MutationInstallPluginInput!
) {
  installPlugin(input: $input) {
    url
  }
}
`}}}();K.hash="9485852b5c3f8af60cbb9992ab30bb2f";const Q=e=>{const n=y.useFragment(I,e.pluginInstallation),[t,u]=b(async()=>{if(n.url.startsWith("https://cdn.jsdelivr.net/gh/")){const[,r,g,l]=n.url.match(/https:\/\/cdn\.jsdelivr\.net\/gh\/([^/]+)\/([^/@]+)@([^/]+)/),m=await(await fetch(`https://data.jsdelivr.com/v1/packages/gh/${r}/${g}/resolved`)).json();return{currentVersion:l,latestVersion:m.version}}else if(n.url.startsWith("https://cdn.jsdelivr.net/npm/")){const[,r,g]=n.url.match(/https:\/\/cdn\.jsdelivr\.net\/npm\/([^/@]+)@([^/]+)/),c=await(await fetch(`https://data.jsdelivr.com/v1/packages/npm/${r}/resolved`)).json();return{currentVersion:g,latestVersion:c.version}}return{currentVersion:null,latestVersion:null}}),[a,s]=k(K),d=(r=n.url)=>{!(t!=null&&t.latestVersion)||!t.currentVersion||(r=n.url.replace(t.currentVersion,t.latestVersion),a({variables:{input:{url:r,override:!0}}}))};return u?i("div",{children:"Loading..."}):!(t!=null&&t.latestVersion)||!t.currentVersion?null:o("div",{className:"flex items-center gap-2",children:[o(V,{onClick:()=>d(),loading:s,children:["Update to ",t.latestVersion]}),o("span",{children:["Current version: ",t.currentVersion]})]})},H=()=>{const e=D(),t=N().installedPlugins.find(u=>u.slug===e.pluginSlug);if(!t)throw new Error(`No plugin found with slug: ${e.pluginSlug}`);return i(R,{pluginInstallation:t})},R=e=>{const n=y.useFragment(w,e.pluginInstallation),[t,u]=k(F),[a,s]=b(async()=>M({pluginSlug:n.slug}),[n.slug]);if(s)return i("div",{children:"Loading..."});if(!a)return null;if("_error"in a)return o("div",{children:["Error: ",a._error]});const d=()=>{t({variables:{input:{slug:n.slug}}})};return o("div",{className:"bg-background-50 flex w-full flex-col gap-4 p-8",children:[o("div",{className:"flex w-full justify-between",children:[i("h1",{className:"text-xl font-medium",children:a.name}),o("div",{className:"flex gap-2",children:[i(Q,{pluginInstallation:n}),i(V,{onClick:d,loading:u,children:"Uninstall"})]})]}),i(f.Suspense,{fallback:"Loading settings... (better loading animation coming soon)",children:i(q,{pluginSlug:n.slug,settings:a.settings??{}})})]})},q=e=>{const n=y.useLazyLoadQuery(x,{where:{pluginSlug:e.pluginSlug,keys:Object.keys(e.settings)}}),[t]=A(U),u=Object.fromEntries(n.storeItems.map(s=>[s.key,s])),a=Object.entries(e.settings);return o("div",{className:"flex flex-col gap-8",children:[a.length===0&&i("div",{children:"This plugin doesn't have any settings to configure. If you would like to configure something about how the plugin behaves, you can contact the plugin author."}),a.map(([s,d])=>{var r,g;return f.createElement(W,{...d,key:s,settingProps:{name:s,updatedAt:(r=u[s])!=null&&r.updatedAt?new Date(u[s].updatedAt):null,value:((g=u[s])==null?void 0:g.value)??void 0,onUpdate:l=>{L.promise(t({variables:{input:{key:s,value:l,pluginSlug:e.pluginSlug,isSecret:d.isSecret,isServerOnly:d.isServerOnly}}}),{loading:"Saving...",success:"Saved!",error:"Failed to save."})}}})})]})},W=e=>{switch(e.type){case"textfield":return i(z,{...e});case"textarea":return i(J,{...e});case"checkbox":return i(X,{...e});case"select":return i(Y,{...e});case"custom":return i(Z,{...e})}},v=2e3,z=e=>{const{register:n,handleSubmit:t,watch:u,formState:a,resetField:s}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=u(e.settingProps.name),[,,r]=S({value:d,isDirty:a.isDirty,isValid:a.isValid},v,({value:l,isDirty:c,isValid:m})=>{!m||!c||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{a.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),o("form",{onSubmit:t(g),children:[i(O,{...e,type:e.inputType??(e.isSecret?"password":"text"),description:e.description&&i(p,{children:e.description}),...n(e.settingProps.name,e.registerOptions),error:a.errors[e.settingProps.name],className:$(!e.fullWidth&&"max-w-sm",e.className)}),e.settingProps.updatedAt&&o("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},J=e=>{const{register:n,handleSubmit:t,watch:u,formState:a,resetField:s}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=u(e.settingProps.name),[,,r]=S({value:d,isDirty:a.isDirty,isValid:a.isValid},v,({value:l,isDirty:c,isValid:m})=>{!m||!c||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{a.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),o("form",{onSubmit:t(g),children:[i(j,{...e,description:e.description&&i(p,{children:e.description}),...n(e.settingProps.name,e.registerOptions),error:a.errors[e.settingProps.name]}),e.settingProps.updatedAt&&o("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},X=e=>{const{control:n,handleSubmit:t,watch:u,formState:a,resetField:s}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=u(e.settingProps.name),[,,r]=S({value:d,isDirty:a.isDirty,isValid:a.isValid},v,({value:l,isValid:c,isDirty:m})=>{!c||!m||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{a.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),o("form",{onSubmit:t(g),className:"flex flex-col items-start gap-1",children:[i("div",{className:"text-foreground-900 text-base font-medium",children:e.title}),e.description&&i(p,{children:e.description}),i(C,{...e,name:e.settingProps.name,control:n,checkboxProps:{...e.checkboxProps,label:e.label},error:a.errors[e.settingProps.name]}),e.settingProps.updatedAt&&o("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},Y=e=>{const{control:n,handleSubmit:t,formState:u,watch:a,resetField:s}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=a(e.settingProps.name),[,,r]=S({value:d,isDirty:u.isDirty,isValid:u.isValid},v,({value:l,isDirty:c,isValid:m})=>{!m||!c||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{u.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),o("form",{onSubmit:t(g),children:[o(E,{...e,name:e.settingProps.name,control:n,error:u.errors[e.settingProps.name],children:[i(T,{className:"max-w-xs",children:e.placeholder}),i(B,{children:e.options.map(l=>i(_,{value:l.value,children:l.label},JSON.stringify(l.value)))})]}),e.settingProps.updatedAt&&o("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},Z=e=>{const n=e.render;return i(n,{onUpdate:e.settingProps.onUpdate,value:e.settingProps.value})};export{H as default};
