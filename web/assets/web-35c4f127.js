import{j as e,ak as V,al as k,am as B,an as I,ao as R,ap as T,aq as z}from"./index-b60f1d3d.js";import{d as A}from"./index-d3fc9829.js";const U=A(n=>{const o=n.React,i=n.components,j=()=>{var t,a;const s=n.operations.useLazyQuery({operationName:"accounts"});return e.jsxs("div",{className:"flex flex-col gap-2 rounded w-full bg-background-50 shadow p-4 max-w-3xl",children:[(t=s==null?void 0:s.data)==null?void 0:t.map(r=>{const l=n.dayjs(r.connectedAt),d=n.dayjs(r.expiresAt);return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"font-semibold",children:r.email}),e.jsxs("span",{className:"text-sm text-foreground-700",children:["connected ",l.fromNow()," â€¢ expires ",d.fromNow()]})]},r.email)}),e.jsx("a",{href:`${n.serverOrigin}/api/plugin/linear/auth`,children:(a=s==null?void 0:s.data)!=null&&a.length?e.jsx(i.Button,{secondary:!0,children:"Connect another account"}):e.jsx(i.Button,{children:"Connect Linear"})})]})},g=s=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:s.size??20,height:s.size??20,viewBox:"0 0 100 100",children:e.jsx("path",{fill:"currentColor",d:"M1.22541 61.5228c-.2225-.9485.90748-1.5459 1.59638-.857L39.3342 97.1782c.6889.6889.0915 1.8189-.857 1.5964C20.0515 94.4522 5.54779 79.9485 1.22541 61.5228ZM.00189135 46.8891c-.01764375.2833.08887215.5599.28957165.7606L52.3503 99.7085c.2007.2007.4773.3075.7606.2896 2.3692-.1476 4.6938-.46 6.9624-.9259.7645-.157 1.0301-1.0963.4782-1.6481L2.57595 39.4485c-.55186-.5519-1.49117-.2863-1.648174.4782-.465915 2.2686-.77832 4.5932-.92588465 6.9624ZM4.21093 29.7054c-.16649.3738-.08169.8106.20765 1.1l64.77602 64.776c.2894.2894.7262.3742 1.1.2077 1.7861-.7956 3.5171-1.6927 5.1855-2.684.5521-.328.6373-1.0867.1832-1.5407L8.43566 24.3367c-.45409-.4541-1.21271-.3689-1.54074.1832-.99132 1.6684-1.88843 3.3994-2.68399 5.1855ZM12.6587 18.074c-.3701-.3701-.393-.9637-.0443-1.3541C21.7795 6.45931 35.1114 0 49.9519 0 77.5927 0 100 22.4073 100 50.0481c0 14.8405-6.4593 28.1724-16.7199 37.3375-.3903.3487-.984.3258-1.3542-.0443L12.6587 18.074Z"})}),w=()=>{var t;const s=n.operations.useLazyQuery({operationName:"views"});return e.jsxs("div",{className:"flex flex-col gap-4 bg-background-50 shadow px-4 py-2 rounded max-w-3xl",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Linear Views"}),e.jsx("div",{className:"text-foreground-700",children:"Create and connect views to sync issues from Linear with specific filters."})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(h,{isUserIssues:!0,view:{id:"my-issues",name:"My Issues",account:"me",synced:!0,color:null,icon:null}}),(t=s==null?void 0:s.data)==null?void 0:t.views.map(a=>e.jsx(h,{view:a},a.id))]})]})},h=s=>{const[t,a]=n.operations.useMutation("addViewToSync"),[r,l]=n.operations.useMutation("removeViewToSync"),d=s.view.color?n.nearestTailwindColor(s.view.color):"blue";return e.jsxs("div",{className:"flex gap-2 w-full items-center",children:[e.jsx("div",{className:`h-2 w-2 rounded-full bg-${d}-500`}),e.jsx("div",{className:"font-semibold",children:s.view.name}),s.isUserIssues?e.jsx("div",{className:"bg-primary-50 text-primary-500 rounded-md text-sm shadow-none px-2 py-1",children:"Connected"}):s.view.synced?e.jsx(i.Button,{secondary:!0,sm:!0,onClick:()=>r({viewId:s.view.id,account:s.view.account}),loading:l,children:"Disconnect"}):e.jsx(i.Button,{secondary:!0,sm:!0,onClick:()=>t({viewId:s.view.id,account:s.view.account}),loading:a,children:"Connect"})]})},v=()=>{const[s,t]=o.useState(!0),[a,r]=o.useState(!1),[l,d]=o.useState([]),[m,p]=o.useState({viewId:"my-issues",account:"me"});n.hooks.useAsyncEffect(async()=>{var x,u;t(!0);const c=await n.operations.query({operationName:"views"}).finally(()=>t(!1));r(((x=c==null?void 0:c.data)==null?void 0:x.connected)??!1),d(((u=c==null?void 0:c.data)==null?void 0:u.views)??[])},[]);const[y,N]=n.operations.useMutation("syncUserIssues",{minimumWait:1e3}),[b,C]=n.operations.useMutation("syncView",{minimumWait:1e3}),f=N||C,L=()=>{m.viewId==="my-issues"?y():b(m)};return e.jsxs("div",{className:"flex flex-col gap-2 bg-background-100 h-full",children:[e.jsx("div",{className:"px-4 pt-3 flex",children:e.jsx("span",{className:"text-xl font-semibold",children:"Linear"})}),e.jsxs("div",{className:"px-3 flex justify-between gap-2 items-center",children:[e.jsxs(i.Select,{defaultValue:"my-issues",onValueChange:c=>p(x=>{const u=l.find(S=>S.id===c);return u?{viewId:c,account:u.account}:x}),children:[e.jsxs(i.SelectUnstyledTrigger,{className:"flex items-center gap-2 text-foreground-700 text-base font-semibold hover:text-primary-500",children:[e.jsx(i.SelectValue,{}),e.jsx(R,{size:14,color:"currentColor"})]}),e.jsxs(i.SelectContent,{align:"start",children:[e.jsx(i.SelectItem,{value:"my-issues",children:"My Issues"}),l.map(c=>e.jsx(i.SelectItem,{value:c.id,children:c.name})),e.jsx(i.SelectSeparator,{}),e.jsxs("div",{className:"max-w-48 text-foreground-700 text-center",children:["Go to"," ",e.jsx("a",{href:"/settings/plugin/linear",className:"underline hover:no-underline",children:"settings"})," ","to connect views from Linear."]})]})]}),e.jsx(i.Button,{tertiary:!0,sm:!0,onClick:L,disabled:f,children:e.jsx(T,{size:20,className:n.tw(f&&"animate-spin")})})]}),s?e.jsx("div",{className:"h-full flex items-center justify-center transform scale-70",children:e.jsx(i.Loading,{})}):e.jsxs(e.Fragment,{children:[!a&&e.jsx("div",{className:"h-full flex items-center justify-center p-3",children:e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx("div",{className:"text-center",children:"Connect your Linear account to get started."}),e.jsx("a",{href:`${n.serverOrigin}/api/plugin/linear/auth`,children:e.jsx(i.Button,{children:"Connect Linear"})})]})}),e.jsx(i.ItemsList,{where:{isRelevant:!0,pluginDatas:{some:{pluginSlug:n.pluginSlug,min:{path:["views"],array_contains:[m.viewId]}}}},emptyState:a?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(z,{size:32,className:"text-foreground-700"}),e.jsx("div",{className:"text-foreground-700",children:"No issues found"})]})}):null})]})]})};return{name:"Linear",settings:{"connect-account":{type:"custom",render:()=>e.jsx(i.ErrorBoundary,{fallbackRender:({error:s})=>{var t,a,r;return((r=(a=(t=s.cause)==null?void 0:t[0])==null?void 0:a.extensions)==null?void 0:r.code)==="NOT_AUTHENTICATED"?e.jsx(e.Fragment,{}):e.jsx("p",{className:"text-sm text-negative-600",children:s.message})},children:e.jsx(o.Suspense,{fallback:e.jsxs("div",{className:"flex flex-col gap-2 rounded w-full bg-background-50 shadow p-4 max-w-3xl",children:[e.jsx("div",{className:"text-foreground-700",children:"Loading connected accounts..."}),e.jsx("a",{href:`${n.serverOrigin}/api/plugin/linear/auth`,children:e.jsx(i.Button,{children:"Connect Linear"})})]}),children:e.jsx(j,{})})})},views:{type:"custom",render:()=>e.jsx(i.ErrorBoundary,{fallbackRender:({error:s})=>e.jsx("p",{className:"text-sm text-negative-600",children:s.message}),children:e.jsx(o.Suspense,{fallback:"Loading views...",children:e.jsx(w,{})})})},syncAllViews:{type:"custom",render:()=>{const[s,t]=o.useState(!1);return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(i.Button,{secondary:!0,onClick:async()=>{t(!0),await n.operations.mutation({operationName:"syncAllViews"}),t(!1)},loading:s,children:"Refresh All Views"}),e.jsx("div",{children:"This will refresh all views and their issues. This may take a while."})]})}}},renderLists:async()=>[{id:"linear",name:"Linear",icon:e.jsx(g,{})}],renderList:async()=>({component:v}),renderItemCardDetails:async({item:s})=>{const t=s.pluginDatas.find(l=>l.pluginSlug===n.pluginSlug);if(!t)return null;const a=t.min,r=n.nearestTailwindColor(a.state.color);return[{component:()=>e.jsx(i.Badge,{className:`bg-${r}-200 text-${r}-700`,children:a.state.name})},{component:()=>M[a.priority]}]},renderItemCardActions:async({item:s})=>{const t=s.pluginDatas.find(r=>r.pluginSlug===n.pluginSlug);if(!t)return null;const a=t.min;return[{component:()=>e.jsx("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"bg-background-200 text-foreground-700 hover:bg-background-300 active:bg-background-300 flex h-6 w-6 items-center justify-center rounded-full bg-opacity-50 text-sm hover:bg-opacity-70 active:bg-opacity-100",children:e.jsx(g,{size:16})})}]}}}),M={0:null,1:e.jsxs("div",{className:"bg-orange-200 text-orange-700 flex items-center gap-1 px-1 py-px rounded text-sm",children:[e.jsx(V,{size:14}),"Urgent"]}),2:e.jsxs("div",{className:"bg-gray-200 text-gray-700 flex items-center gap-1 px-1 py-px rounded text-sm",children:[e.jsx(k,{size:14}),"High"]}),3:e.jsxs("div",{className:"bg-gray-200 text-gray-700 flex items-center gap-1 px-1 py-px rounded text-sm",children:[e.jsx(B,{size:14}),"Medium"]}),4:e.jsxs("div",{className:"bg-gray-200 text-gray-700 flex items-center gap-1 px-1 py-px rounded text-sm",children:[e.jsx(I,{size:14}),"Low"]})};export{U as default};
