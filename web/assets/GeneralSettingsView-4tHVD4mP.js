import{j as e,i as g,k as x,F as u,B as w,l as P,a as S,n as k,m as i}from"./index-BVjnAyDl.js";const m=function(){var n=[{defaultValue:null,kind:"LocalArgument",name:"input"}],a=[{alias:"newToken",args:[{kind:"Variable",name:"input",variableName:"input"}],kind:"ScalarField",name:"changePassword",storageKey:null}];return{fragment:{argumentDefinitions:n,kind:"Fragment",metadata:null,name:"GeneralSettingsViewChangePasswordMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"GeneralSettingsViewChangePasswordMutation",selections:a},params:{cacheID:"6fa91b38968cfe09504f4f102ec432ce",id:null,metadata:{},name:"GeneralSettingsViewChangePasswordMutation",operationKind:"mutation",text:`mutation GeneralSettingsViewChangePasswordMutation(
  $input: MutationChangePasswordInput!
) {
  newToken: changePassword(input: $input)
}
`}}}();m.hash="10003f56ffad278cf6521eb39ce5b69f";const p=function(){var n=[{alias:null,args:null,kind:"ScalarField",name:"logout",storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"GeneralSettingsViewLogoutMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"GeneralSettingsViewLogoutMutation",selections:n},params:{cacheID:"1ac28a93faab21c06a11e063ca1de59e",id:null,metadata:{},name:"GeneralSettingsViewLogoutMutation",operationKind:"mutation",text:`mutation GeneralSettingsViewLogoutMutation {
  logout
}
`}}}();p.hash="6b42c965d968abafa0d1352a793751e6";const y=()=>e.jsxs("div",{className:"flex flex-col gap-8 p-8",children:[e.jsx(b,{}),e.jsx(v,{})]}),b=()=>{const[n,a]=g(m),{register:s,handleSubmit:l,formState:o,setError:d,reset:t}=x(),f=c=>{n({variables:{input:{oldPassword:c.oldPassword,newPassword:c.newPassword}},onError:r=>d("newPasswordConfirm",{message:r.message}),onCompleted:r=>{k.success("Password changed successfully.");const h=window.localStorage.getItem(i);console.info(`${h} is no longer valid.`),console.info(`New token: ${r.newToken}`),window.localStorage.setItem(i,r.newToken),t()}})};return e.jsxs("form",{className:"flex flex-col items-start gap-2",children:[e.jsx(u,{type:"password",label:"Old password",...s("oldPassword",{required:"Please enter your current password."})}),e.jsx(u,{type:"password",label:"New password",...s("newPassword",{required:"Please enter your new password."}),error:o.errors.newPassword,hasError:!!o.errors.newPasswordConfirm}),e.jsx(u,{type:"password",label:"Confirm new password",...s("newPasswordConfirm",{required:"Please confirm your new password.",minLength:{value:8,message:"Your new password must be at least 8 characters long."}}),error:o.errors.newPasswordConfirm}),e.jsx(w,{onClick:l(f),loading:a,children:"Change password"})]})},v=()=>{const n=P(),[a,s]=g(p),[l,o]=S.useState(),d=()=>{a({variables:{},onError:t=>o(t.message),onCompleted:()=>{const t=window.localStorage.getItem(i);console.info(`${t} is no longer valid.`),window.localStorage.removeItem(i),n("/login")}})};return e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsx("div",{children:"Before logging out, remember to save your password so you can log back in."}),e.jsx(w,{danger:!0,onClick:d,loading:s,children:"Logout"}),e.jsx("div",{className:"text-negative-500 text-sm",children:l})]})};export{y as default};
