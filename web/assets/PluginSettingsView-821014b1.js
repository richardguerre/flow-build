import{r as y,g as p,i as k,j as i,c as u,B as x,R as N,t as V,a as f,N as M,Q as A,h as L,p as O,n as j,k as P,x as S,F as $,U as b,d as h,W as E,X as C,Y as T,Z as B,_ as R}from"./index-e40f1048.js";const w={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PluginSettingsView_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{args:null,kind:"FragmentSpread",name:"UpdatePluginButton_pluginInstallation"}],type:"PluginInstallation",abstractKey:null};w.hash="67f79a352a26070e5e09d7779cbd1693";const F=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"uninstallPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUninstallPluginMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUninstallPluginMutation",selections:n},params:{cacheID:"3a8a65cc7d44dc0f5ebc9b34a42765cb",id:null,metadata:{},name:"PluginSettingsViewUninstallPluginMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUninstallPluginMutation(
  $input: MutationUninstallPluginInput!
) {
  uninstallPlugin(input: $input) {
    slug
  }
}
`}}}();F.hash="2cbb01b9fde710cf5586414364e23623";const U=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"where"}],n=[{alias:null,args:[{kind:"Variable",name:"where",variableName:"where"}],concreteType:"Store",kind:"LinkedField",name:"storeItems",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewQuery",selections:n,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewQuery",selections:n},params:{cacheID:"4457517258b897202b36e860b504742f",id:null,metadata:{},name:"PluginSettingsViewQuery",operationKind:"query",text:`query PluginSettingsViewQuery(
  $where: QueryStoreItemsInput!
) {
  storeItems(where: $where) {
    id
    updatedAt
    key
    value
    pluginSlug
    isSecret
    isServerOnly
  }
}
`}}}();U.hash="50fe46f4df785eec0286be0cdb0e79d3";const I=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:n,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"PluginSettingsViewStoreItem_item"}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:n,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}]},params:{cacheID:"ac99ed281b52dedb236cfd3cbf578c13",id:null,metadata:{},name:"PluginSettingsViewUpdatePluginSettingsMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUpdatePluginSettingsMutation(
  $input: MutationUpsertStoreItemInput!
) {
  upsertStoreItem(input: $input) {
    ...PluginSettingsViewStoreItem_item
    id
  }
}

fragment PluginSettingsViewStoreItem_item on Store {
  id
  updatedAt
  key
  value
  pluginSlug
  isSecret
  isServerOnly
}
`}}}();I.hash="6220986d895d0d9050d5577a61064ded";const K={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UpdatePluginButton_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"PluginInstallation",abstractKey:null};K.hash="4f1184aecaeea8735d4c8df05106bcd6";const D=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"installPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UpdatePluginButtonUpdatePluginMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UpdatePluginButtonUpdatePluginMutation",selections:n},params:{cacheID:"c510b96612a525835fd97692b2f99e5c",id:null,metadata:{},name:"UpdatePluginButtonUpdatePluginMutation",operationKind:"mutation",text:`mutation UpdatePluginButtonUpdatePluginMutation(
  $input: MutationInstallPluginInput!
) {
  installPlugin(input: $input) {
    url
  }
}
`}}}();D.hash="9485852b5c3f8af60cbb9992ab30bb2f";const _=e=>{const n=y.useFragment(K,e.pluginInstallation),[a,s]=p(async()=>{if(n.url.startsWith("https://cdn.jsdelivr.net/gh/")){const[,r,g,l]=n.url.match(/https:\/\/cdn\.jsdelivr\.net\/gh\/([^/]+)\/([^/@]+)@([^/]+)/),m=await(await fetch(`https://data.jsdelivr.com/v1/packages/gh/${r}/${g}/resolved`)).json();return{currentVersion:l,latestVersion:m.version}}else if(n.url.startsWith("https://cdn.jsdelivr.net/npm/")){const[,r,g]=n.url.match(/https:\/\/cdn\.jsdelivr\.net\/npm\/([^/@]+)@([^/]+)/),c=await(await fetch(`https://data.jsdelivr.com/v1/packages/npm/${r}/resolved`)).json();return{currentVersion:g,latestVersion:c.version}}return{currentVersion:null,latestVersion:null}}),[t,o]=k(D),d=(r=n.url)=>{!(a!=null&&a.latestVersion)||!a.currentVersion||(r=n.url.replace(a.currentVersion,a.latestVersion),t({variables:{input:{url:r,override:!0}}}))};return s?i("div",{children:"Loading..."}):!(a!=null&&a.latestVersion)||!a.currentVersion?null:u("div",{className:"flex items-center gap-2",children:[u(x,{onClick:()=>d(),loading:o,children:["Update to ",a.latestVersion]}),u("span",{children:["Current version: ",a.currentVersion]})]})},Q=N.forwardRef((e,n)=>i("textarea",{...e,ref:n,className:V("ring-primary-200 placeholder:text-foreground-700 text-foreground-900 disabled:bg-background-300/50 disabled:ring-none hover:ring-primary-300 focus:ring-primary-500 w-full rounded-md px-3 py-2 text-sm outline-none ring transition-colors duration-300 ease-in-out",e.hasError&&"ring-negative-600 hover:ring-negative-600 focus:ring-negative-600 placeholder:text-negative-600",e.className)})),q=f.forwardRef((e,n)=>{const a=typeof e.error=="object"?e.error.message:e.error;return u("label",{className:"flex flex-col gap-1",children:[e.label&&i("div",{className:"text-foreground-900 text-base font-medium",children:e.label}),typeof e.description=="string"?i("div",{className:"text-foreground-700 text-sm",children:e.description}):e.description,i(Q,{...e,ref:n,hasError:!!a||e.hasError}),a&&i("div",{className:"text-negative-600 text-sm",children:a})]})}),ne=()=>{const e=M(),a=A().installedPlugins.find(s=>s.slug===e.pluginSlug);if(!a)throw new Error(`No plugin found with slug: ${e.pluginSlug}`);return i(W,{pluginInstallation:a})},W=e=>{const n=y.useFragment(w,e.pluginInstallation),[a,s]=k(F),[t,o]=p(async()=>L({pluginSlug:n.slug}),[n.slug]);if(o)return i("div",{children:"Loading..."});if(!t)return null;if("_error"in t)return u("div",{children:["Error: ",t._error]});const d=()=>{a({variables:{input:{slug:n.slug}}})};return u("div",{className:"bg-background-50 flex w-full flex-col gap-4 p-8",children:[u("div",{className:"flex w-full justify-between",children:[i("h1",{className:"text-xl font-medium",children:t.name}),u("div",{className:"flex gap-2",children:[i(_,{pluginInstallation:n}),i(x,{onClick:d,loading:s,children:"Uninstall"})]})]}),i(f.Suspense,{fallback:"Loading settings... (better loading animation coming soon)",children:i(z,{pluginSlug:n.slug,settings:t.settings??{}})})]})},z=e=>{const n=y.useLazyLoadQuery(U,{where:{pluginSlug:e.pluginSlug,keys:Object.keys(e.settings)}}),[a]=O(I),s=Object.fromEntries(n.storeItems.map(t=>[t.key,t]));return i("div",{className:"flex flex-col gap-8",children:Object.entries(e.settings).map(([t,o])=>{var d,r;return f.createElement(J,{...o,key:t,settingProps:{name:t,updatedAt:(d=s[t])!=null&&d.updatedAt?new Date(s[t].updatedAt):null,value:((r=s[t])==null?void 0:r.value)??void 0,onUpdate:g=>{j.promise(a({variables:{input:{key:t,value:g,pluginSlug:e.pluginSlug,isSecret:o.isSecret,isServerOnly:o.isServerOnly}}}),{loading:"Saving...",success:"Saved!",error:"Failed to save."})}}})})})},J=e=>{switch(e.type){case"textfield":return i(X,{...e});case"textarea":return i(Y,{...e});case"checkbox":return i(Z,{...e});case"select":return i(G,{...e});case"custom":return i(H,{...e})}},v=2e3,X=e=>{const{register:n,handleSubmit:a,watch:s,formState:t,resetField:o}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=s(e.settingProps.name),[,,r]=S({value:d,isDirty:t.isDirty,isValid:t.isValid},v,({value:l,isDirty:c,isValid:m})=>{!m||!c||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{t.isDirty&&o(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),u("form",{onSubmit:a(g),children:[i($,{...e,type:e.inputType??e.isSecret?"password":"text",description:e.description&&i(b,{children:e.description}),...n(e.settingProps.name,e.registerOptions),error:t.errors[e.settingProps.name],className:V(!e.fullWidth&&"max-w-sm",e.className)}),e.settingProps.updatedAt&&u("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},Y=e=>{const{register:n,handleSubmit:a,watch:s,formState:t,resetField:o}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=s(e.settingProps.name),[,,r]=S({value:d,isDirty:t.isDirty,isValid:t.isValid},v,({value:l,isDirty:c,isValid:m})=>{!m||!c||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{t.isDirty&&o(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),u("form",{onSubmit:a(g),children:[i(q,{...e,description:e.description&&i(b,{children:e.description}),...n(e.settingProps.name,e.registerOptions),error:t.errors[e.settingProps.name]}),e.settingProps.updatedAt&&u("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},Z=e=>{const{control:n,handleSubmit:a,watch:s,formState:t,resetField:o}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=s(e.settingProps.name),[,,r]=S({value:d,isDirty:t.isDirty,isValid:t.isValid},v,({value:l,isValid:c,isDirty:m})=>{!c||!m||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{t.isDirty&&o(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),u("form",{onSubmit:a(g),className:"flex flex-col items-start gap-1",children:[i("div",{className:"text-foreground-900 text-base font-medium",children:e.title}),e.description&&i(b,{children:e.description}),i(E,{...e,name:e.settingProps.name,control:n,checkboxProps:{...e.checkboxProps,label:e.label},error:t.errors[e.settingProps.name]}),e.settingProps.updatedAt&&u("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},G=e=>{const{control:n,handleSubmit:a,formState:s,watch:t,resetField:o}=P({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),d=t(e.settingProps.name),[,,r]=S({value:d,isDirty:s.isDirty,isValid:s.isValid},v,({value:l,isDirty:c,isValid:m})=>{!m||!c||e.settingProps.onUpdate(l)}),g=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return f.useEffect(()=>{s.isDirty&&o(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),u("form",{onSubmit:a(g),children:[u(C,{...e,name:e.settingProps.name,control:n,error:s.errors[e.settingProps.name],children:[i(T,{className:"max-w-xs",children:e.placeholder}),i(B,{children:e.options.map(l=>i(R,{value:l.value,children:l.label},JSON.stringify(l.value)))})]}),e.settingProps.updatedAt&&u("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",h(e.settingProps.updatedAt).fromNow()]})]})},H=e=>{const n=e.render;return i(n,{onUpdate:e.settingProps.onUpdate,value:e.settingProps.value})};export{ne as default};
