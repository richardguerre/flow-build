import{j as e}from"./index-b60f1d3d.js";import{d as g}from"./index-d3fc9829.js";const k=g(t=>{const d=t.React,l=t.components,v=()=>{var h,j;const a=t.operations.useLazyQuery({operationName:"calendars"}),r=new Set(((h=a==null?void 0:a.data)==null?void 0:h.flatMap(n=>"authError"in n?[]:n.calendars).filter(n=>n.connected&&!!n.id).map(n=>n.id))??[]),[s,c]=d.useState(r),[i,u]=t.hooks.useDebounce(s,1e3),[f,m]=d.useState(!1),p=n=>{s.has(n)?s.delete(n):s.add(n),c(new Set(s))};t.hooks.useAsyncEffect(async()=>{i.size===r.size&&Array.from(i).every(n=>r.has(n))||(m(!0),await t.operations.mutation({operationName:"connectCalendars",input:{calendarIds:Array.from(i)}}),m(!1))},[i]);let o="Saved";return u&&!f?o="Not saved yet...":!u&&f?o="Saving...":o="Saved",e.jsxs("div",{className:"flex flex-col gap-2",children:[(j=a==null?void 0:a.data)==null?void 0:j.map(n=>e.jsxs("div",{className:"flex flex-col gap-2 rounded w-full bg-background-50 shadow px-4 py-2",children:[e.jsx("div",{className:"flex justify-between gap-2 items-center",children:e.jsx("div",{className:"font-semibold",children:n.account})}),e.jsx("div",{className:"flex flex-col gap-2",children:"authError"in n?e.jsxs("div",{className:"text-foreground-900 text-negative-500",children:["Account incorrectly connected. (",n.authError,")"]}):n.calendars.map(x=>e.jsx(l.CheckboxWithLabel,{label:x.summary??"Unknown calendar",checked:s.has(x.id),onCheckedChange:()=>p(x.id)}))})]})),e.jsx("div",{className:"italic text-sm text-foreground-700",children:o})]})};return{name:"Google Calendar",settings:{"connect-account":{type:"custom",render:()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("a",{href:`${t.serverOrigin}/api/plugin/google-calendar/auth`,children:e.jsx(l.Button,{children:"Connect an account"})}),e.jsx(l.ErrorBoundary,{fallbackRender:({error:a})=>{var r,s,c;return((c=(s=(r=a.cause)==null?void 0:r[0])==null?void 0:s.extensions)==null?void 0:c.code)==="NOT_AUTHENTICATED"?e.jsx(e.Fragment,{}):e.jsx("p",{className:"text-sm text-negative-600",children:a.message})},children:e.jsx(d.Suspense,{fallback:"Loading connected accounts...",children:e.jsx(v,{})})})]})}},routineSteps:{"create-tasks-from-events":{name:"Create tasks from events",description:"Create tasks from events in your connected Google Calendars.",component:a=>e.jsx("div",{children:e.jsxs("div",{children:[e.jsx(a.BackButton,{}),e.jsx(a.NextButton,{})]})})}}}});export{k as default};
