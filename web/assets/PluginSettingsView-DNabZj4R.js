import{r as y,i as v,j as n,B as b,a7 as U,a8 as I,f as K,h as D,a as m,a9 as N,Z as M,n as A,k as f,a1 as P,F as L,aa as h,t as O,d as S,ab as C,ac as E,y as $,z as T,E as B,G as _}from"./index-CFTN-Ahm.js";const p={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PluginSettingsView_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{args:null,kind:"FragmentSpread",name:"UpdatePluginButton_pluginInstallation"}],type:"PluginInstallation",abstractKey:null};p.hash="67f79a352a26070e5e09d7779cbd1693";const k=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"uninstallPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUninstallPluginMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUninstallPluginMutation",selections:t},params:{cacheID:"3a8a65cc7d44dc0f5ebc9b34a42765cb",id:null,metadata:{},name:"PluginSettingsViewUninstallPluginMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUninstallPluginMutation(
  $input: MutationUninstallPluginInput!
) {
  uninstallPlugin(input: $input) {
    slug
  }
}
`}}}();k.hash="2cbb01b9fde710cf5586414364e23623";const F=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"where"}],t=[{alias:null,args:[{kind:"Variable",name:"where",variableName:"where"}],concreteType:"Store",kind:"LinkedField",name:"storeItems",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewQuery",selections:t},params:{cacheID:"4457517258b897202b36e860b504742f",id:null,metadata:{},name:"PluginSettingsViewQuery",operationKind:"query",text:`query PluginSettingsViewQuery(
  $where: QueryStoreItemsInput!
) {
  storeItems(where: $where) {
    id
    updatedAt
    key
    value
    pluginSlug
    isSecret
    isServerOnly
  }
}
`}}}();F.hash="50fe46f4df785eec0286be0cdb0e79d3";const j=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"input",variableName:"input"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:t,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"PluginSettingsViewStoreItem_item"}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:t,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}]},params:{cacheID:"ac99ed281b52dedb236cfd3cbf578c13",id:null,metadata:{},name:"PluginSettingsViewUpdatePluginSettingsMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUpdatePluginSettingsMutation(
  $input: MutationUpsertStoreItemInput!
) {
  upsertStoreItem(input: $input) {
    ...PluginSettingsViewStoreItem_item
    id
  }
}

fragment PluginSettingsViewStoreItem_item on Store {
  id
  updatedAt
  key
  value
  pluginSlug
  isSecret
  isServerOnly
}
`}}}();j.hash="6220986d895d0d9050d5577a61064ded";const w=function(){var e={alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UpdatePluginButton_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},e,{alias:null,args:null,concreteType:"PluginVersion",kind:"LinkedField",name:"latestVersion",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"installUrl",storageKey:null}],storageKey:null}],type:"PluginInstallation",abstractKey:null}}();w.hash="9fd362a9af23a199b016e0e46ec7139d";const V=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"installPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UpdatePluginButtonUpdatePluginMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UpdatePluginButtonUpdatePluginMutation",selections:t},params:{cacheID:"c510b96612a525835fd97692b2f99e5c",id:null,metadata:{},name:"UpdatePluginButtonUpdatePluginMutation",operationKind:"mutation",text:`mutation UpdatePluginButtonUpdatePluginMutation(
  $input: MutationInstallPluginInput!
) {
  installPlugin(input: $input) {
    url
  }
}
`}}}();V.hash="9485852b5c3f8af60cbb9992ab30bb2f";const Q=e=>{const t=y.useFragment(w,e.pluginInstallation),[u,s]=v(V),a=t.version,l=t.latestVersion,r=()=>{!l||!a||u({variables:{input:{url:l.installUrl,override:!0}}})};return!l||!a||l.version===a?null:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(b,{onClick:()=>r(),loading:s,children:["Update to ",l.version]}),n.jsxs("span",{children:["Current version: ",a]})]})},Y=()=>{const e=U(),u=I().installedPlugins.find(s=>s.slug===e.pluginSlug);if(!u)throw new Error(`No plugin found with slug: ${e.pluginSlug}`);return n.jsx(R,{pluginInstallation:u})},R=e=>{const t=y.useFragment(p,e.pluginInstallation),[u,s]=v(k),[a,l]=K(async()=>D({pluginSlug:t.slug}),[t.slug]);if(l)return n.jsx("div",{children:"Loading..."});if(!a)return null;if("_error"in a)return n.jsxs("div",{children:["Error: ",a._error]});const r=()=>{u({variables:{input:{slug:t.slug}}})};return n.jsxs("div",{className:"bg-background-50 flex w-full flex-col gap-4 p-8",children:[n.jsxs("div",{className:"flex w-full justify-between",children:[n.jsx("h1",{className:"text-xl font-medium",children:a.name}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Q,{pluginInstallation:t}),n.jsx(b,{onClick:r,loading:s,children:"Uninstall"})]})]}),n.jsx(m.Suspense,{fallback:n.jsx(N,{}),children:n.jsx(q,{pluginSlug:t.slug,settings:a.settings??{}})})]})},q=e=>{const t=y.useLazyLoadQuery(F,{where:{pluginSlug:e.pluginSlug,keys:Object.keys(e.settings)}}),[u]=M(j),s=Object.fromEntries(t.storeItems.map(l=>[l.key,l])),a=Object.entries(e.settings);return n.jsxs("div",{className:"flex flex-col gap-8",children:[a.length===0&&n.jsx("div",{children:"This plugin doesn't have any settings to configure. If you would like to configure something about how the plugin behaves, you can contact the plugin author."}),a.map(([l,r])=>{var o,d;return m.createElement(z,{...r,key:l,settingProps:{name:l,updatedAt:(o=s[l])!=null&&o.updatedAt?new Date(s[l].updatedAt):null,value:((d=s[l])==null?void 0:d.value)??void 0,onUpdate:i=>{A.promise(u({variables:{input:{key:l,value:i,pluginSlug:e.pluginSlug,isSecret:r.isSecret,isServerOnly:r.isServerOnly}}}),{loading:"Saving...",success:"Saved!",error:"Failed to save."})}}})})]})},z=e=>{switch(e.type){case"textfield":return n.jsx(G,{...e});case"textarea":return n.jsx(J,{...e});case"checkbox":return n.jsx(W,{...e});case"select":return n.jsx(Z,{...e});case"custom":return n.jsx(H,{...e})}},x=2e3,G=e=>{const{register:t,handleSubmit:u,watch:s,formState:a,resetField:l}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),r=s(e.settingProps.name),[,,o]=P({value:r,isDirty:a.isDirty,isValid:a.isValid},x,({value:i,isDirty:g,isValid:c})=>{!c||!g||e.settingProps.onUpdate(i)}),d=i=>{o(),e.settingProps.onUpdate(i[e.settingProps.name])};return m.useEffect(()=>{a.isDirty&&l(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:u(d),children:[n.jsx(L,{...e,type:e.inputType??(e.isSecret?"password":"text"),description:e.description&&n.jsx(h,{children:e.description}),...t(e.settingProps.name,e.registerOptions),error:a.errors[e.settingProps.name],className:O(!e.fullWidth&&"max-w-sm",e.className)}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},J=e=>{const{register:t,handleSubmit:u,watch:s,formState:a,resetField:l}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),r=s(e.settingProps.name),[,,o]=P({value:r,isDirty:a.isDirty,isValid:a.isValid},x,({value:i,isDirty:g,isValid:c})=>{!c||!g||e.settingProps.onUpdate(i)}),d=i=>{o(),e.settingProps.onUpdate(i[e.settingProps.name])};return m.useEffect(()=>{a.isDirty&&l(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:u(d),children:[n.jsx(C,{...e,description:e.description&&n.jsx(h,{children:e.description}),...t(e.settingProps.name,e.registerOptions),error:a.errors[e.settingProps.name]}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},W=e=>{const{control:t,handleSubmit:u,watch:s,formState:a,resetField:l}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),r=s(e.settingProps.name),[,,o]=P({value:r,isDirty:a.isDirty,isValid:a.isValid},x,({value:i,isValid:g,isDirty:c})=>{!g||!c||e.settingProps.onUpdate(i)}),d=i=>{o(),e.settingProps.onUpdate(i[e.settingProps.name])};return m.useEffect(()=>{a.isDirty&&l(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:u(d),className:"flex flex-col items-start gap-1",children:[n.jsx("div",{className:"text-foreground-900 text-base font-medium",children:e.title}),e.description&&n.jsx(h,{children:e.description}),n.jsx(E,{...e,name:e.settingProps.name,control:t,checkboxProps:{...e.checkboxProps,label:e.label},error:a.errors[e.settingProps.name]}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},Z=e=>{const{control:t,handleSubmit:u,formState:s,watch:a,resetField:l}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),r=a(e.settingProps.name),[,,o]=P({value:r,isDirty:s.isDirty,isValid:s.isValid},x,({value:i,isDirty:g,isValid:c})=>{!c||!g||e.settingProps.onUpdate(i)}),d=i=>{o(),e.settingProps.onUpdate(i[e.settingProps.name])};return m.useEffect(()=>{s.isDirty&&l(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:u(d),children:[n.jsxs($,{...e,name:e.settingProps.name,control:t,error:s.errors[e.settingProps.name],children:[n.jsx(T,{className:"max-w-xs",children:e.placeholder}),n.jsx(B,{children:e.options.map(i=>n.jsx(_,{value:i.value,children:i.label},JSON.stringify(i.value)))})]}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},H=e=>{const t=e.render;return n.jsx(t,{onUpdate:e.settingProps.onUpdate,value:e.settingProps.value})};export{Y as default};
