import{c as r,j as n,ai as k}from"./index-1b55009a.js";import{d as b}from"./index-d3fc9829.js";const S=b(s=>{const l=s.React,u=s.components,p=()=>{var x,g;const a=s.operations.useLazyQuery({operationName:"calendars"}),c=new Set(((x=a==null?void 0:a.data)==null?void 0:x.flatMap(e=>"authError"in e?[]:e.calendars).filter(e=>e.connected&&!!e.id).map(e=>e.id))??[]),[t,o]=l.useState(c),[d,m]=s.hooks.useDebounce(t,1e3),[h,v]=l.useState(!1),C=e=>{t.has(e)?t.delete(e):t.add(e),o(new Set(t))};s.hooks.useAsyncEffect(async()=>{d.size===c.size&&Array.from(d).every(e=>c.has(e))||(v(!0),await s.operations.mutation({operationName:"connectCalendars",input:{calendarIds:Array.from(d)}}),v(!1))},[d]);let i="Saved";return m&&!h?i="Not saved yet...":!m&&h?i="Saving...":i="Saved",r("div",{className:"flex flex-col gap-2",children:[(g=a==null?void 0:a.data)==null?void 0:g.map(e=>r("div",{className:"flex flex-col gap-2 rounded w-full bg-background-50 shadow px-4 py-2",children:[n("div",{className:"font-semibold",children:e.account}),n("div",{className:"flex flex-col gap-2",children:"authError"in e?r("div",{className:"text-foreground-900 text-negative-500",children:["Account incorrectly connected. (",e.authError,")"]}):e.calendars.map(f=>n(u.CheckboxWithLabel,{label:f.summary??"Unknown calendar",checked:t.has(f.id),onCheckedChange:()=>C(f.id)}))})]})),n("div",{className:"italic text-sm text-foreground-700",children:i})]})};return{name:"Google Calendar",settings:{"connect-account":{type:"custom",render:()=>r("div",{className:"flex flex-col gap-2",children:[n("a",{href:`${s.serverOrigin}/api/plugin/google-calendar/auth`,children:n(u.Button,{children:"Connect an account"})}),n(u.ErrorBoundary,{fallbackRender:({error:a})=>{var c,t,o;return((o=(t=(c=a.cause)==null?void 0:c[0])==null?void 0:t.extensions)==null?void 0:o.code)==="NOT_AUTHENTICATED"?n(k,{}):n("p",{className:"text-sm text-negative-600",children:a.message})},children:n(l.Suspense,{fallback:"Loading connected accounts...",children:n(p,{})})})]})}},routineSteps:{"create-tasks-from-events":{name:"Create tasks from events",description:"Create tasks from events in your connected Google Calendars.",component:a=>n("div",{children:r("div",{children:[n(a.BackButton,{}),n(a.NextButton,{})]})})}}}});export{S as default};
