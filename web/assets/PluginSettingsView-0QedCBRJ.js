import{r as x,f as y,i as p,j as n,B as b,a7 as I,a8 as K,h as D,a as m,a9 as N,Z as M,n as A,k as f,a1 as P,F as L,aa as v,t as O,d as S,ab as $,ac as C,y as E,z as T,E as B,G as _}from"./index-BRGNTpV6.js";const k={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PluginSettingsView_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{args:null,kind:"FragmentSpread",name:"UpdatePluginButton_pluginInstallation"}],type:"PluginInstallation",abstractKey:null};k.hash="67f79a352a26070e5e09d7779cbd1693";const j=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"uninstallPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"slug",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUninstallPluginMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUninstallPluginMutation",selections:t},params:{cacheID:"3a8a65cc7d44dc0f5ebc9b34a42765cb",id:null,metadata:{},name:"PluginSettingsViewUninstallPluginMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUninstallPluginMutation(
  $input: MutationUninstallPluginInput!
) {
  uninstallPlugin(input: $input) {
    slug
  }
}
`}}}();j.hash="2cbb01b9fde710cf5586414364e23623";const V=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"where"}],t=[{alias:null,args:[{kind:"Variable",name:"where",variableName:"where"}],concreteType:"Store",kind:"LinkedField",name:"storeItems",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewQuery",selections:t},params:{cacheID:"4457517258b897202b36e860b504742f",id:null,metadata:{},name:"PluginSettingsViewQuery",operationKind:"query",text:`query PluginSettingsViewQuery(
  $where: QueryStoreItemsInput!
) {
  storeItems(where: $where) {
    id
    updatedAt
    key
    value
    pluginSlug
    isSecret
    isServerOnly
  }
}
`}}}();V.hash="50fe46f4df785eec0286be0cdb0e79d3";const w=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"input",variableName:"input"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:t,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"PluginSettingsViewStoreItem_item"}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PluginSettingsViewUpdatePluginSettingsMutation",selections:[{alias:null,args:t,concreteType:"Store",kind:"LinkedField",name:"upsertStoreItem",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"updatedAt",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pluginSlug",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSecret",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isServerOnly",storageKey:null}],storageKey:null}]},params:{cacheID:"ac99ed281b52dedb236cfd3cbf578c13",id:null,metadata:{},name:"PluginSettingsViewUpdatePluginSettingsMutation",operationKind:"mutation",text:`mutation PluginSettingsViewUpdatePluginSettingsMutation(
  $input: MutationUpsertStoreItemInput!
) {
  upsertStoreItem(input: $input) {
    ...PluginSettingsViewStoreItem_item
    id
  }
}

fragment PluginSettingsViewStoreItem_item on Store {
  id
  updatedAt
  key
  value
  pluginSlug
  isSecret
  isServerOnly
}
`}}}();w.hash="6220986d895d0d9050d5577a61064ded";const F={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UpdatePluginButton_pluginInstallation",selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"PluginInstallation",abstractKey:null};F.hash="4f1184aecaeea8735d4c8df05106bcd6";const U=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"PluginInstallation",kind:"LinkedField",name:"installPlugin",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UpdatePluginButtonUpdatePluginMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UpdatePluginButtonUpdatePluginMutation",selections:t},params:{cacheID:"c510b96612a525835fd97692b2f99e5c",id:null,metadata:{},name:"UpdatePluginButtonUpdatePluginMutation",operationKind:"mutation",text:`mutation UpdatePluginButtonUpdatePluginMutation(
  $input: MutationInstallPluginInput!
) {
  installPlugin(input: $input) {
    url
  }
}
`}}}();U.hash="9485852b5c3f8af60cbb9992ab30bb2f";const Q=e=>{const t=x.useFragment(F,e.pluginInstallation),[a,u]=y(async()=>{if(t.url.startsWith("https://cdn.jsdelivr.net/gh/")){const[,r,d,l]=t.url.match(/https:\/\/cdn\.jsdelivr\.net\/gh\/([^/]+)\/([^/@]+)@([^/]+)/),c=await(await fetch(`https://data.jsdelivr.com/v1/packages/gh/${r}/${d}/resolved`)).json();return{currentVersion:l,latestVersion:c.version}}else if(t.url.startsWith("https://cdn.jsdelivr.net/npm/")){const[,r,d]=t.url.match(/https:\/\/cdn\.jsdelivr\.net\/npm\/([^/@]+)@([^/]+)/),g=await(await fetch(`https://data.jsdelivr.com/v1/packages/npm/${r}/resolved`)).json();return{currentVersion:d,latestVersion:g.version}}return{currentVersion:null,latestVersion:null}}),[i,s]=p(U),o=(r=t.url)=>{!(a!=null&&a.latestVersion)||!a.currentVersion||(r=t.url.replace(a.currentVersion,a.latestVersion),i({variables:{input:{url:r,override:!0}}}))};return u?n.jsx("div",{children:"Loading..."}):!(a!=null&&a.latestVersion)||!a.currentVersion?null:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(b,{onClick:()=>o(),loading:s,children:["Update to ",a.latestVersion]}),n.jsxs("span",{children:["Current version: ",a.currentVersion]})]})},Y=()=>{const e=I(),a=K().installedPlugins.find(u=>u.slug===e.pluginSlug);if(!a)throw new Error(`No plugin found with slug: ${e.pluginSlug}`);return n.jsx(R,{pluginInstallation:a})},R=e=>{const t=x.useFragment(k,e.pluginInstallation),[a,u]=p(j),[i,s]=y(async()=>D({pluginSlug:t.slug}),[t.slug]);if(s)return n.jsx("div",{children:"Loading..."});if(!i)return null;if("_error"in i)return n.jsxs("div",{children:["Error: ",i._error]});const o=()=>{a({variables:{input:{slug:t.slug}}})};return n.jsxs("div",{className:"bg-background-50 flex w-full flex-col gap-4 p-8",children:[n.jsxs("div",{className:"flex w-full justify-between",children:[n.jsx("h1",{className:"text-xl font-medium",children:i.name}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Q,{pluginInstallation:t}),n.jsx(b,{onClick:o,loading:u,children:"Uninstall"})]})]}),n.jsx(m.Suspense,{fallback:n.jsx(N,{}),children:n.jsx(q,{pluginSlug:t.slug,settings:i.settings??{}})})]})},q=e=>{const t=x.useLazyLoadQuery(V,{where:{pluginSlug:e.pluginSlug,keys:Object.keys(e.settings)}}),[a]=M(w),u=Object.fromEntries(t.storeItems.map(s=>[s.key,s])),i=Object.entries(e.settings);return n.jsxs("div",{className:"flex flex-col gap-8",children:[i.length===0&&n.jsx("div",{children:"This plugin doesn't have any settings to configure. If you would like to configure something about how the plugin behaves, you can contact the plugin author."}),i.map(([s,o])=>{var r,d;return m.createElement(W,{...o,key:s,settingProps:{name:s,updatedAt:(r=u[s])!=null&&r.updatedAt?new Date(u[s].updatedAt):null,value:((d=u[s])==null?void 0:d.value)??void 0,onUpdate:l=>{A.promise(a({variables:{input:{key:s,value:l,pluginSlug:e.pluginSlug,isSecret:o.isSecret,isServerOnly:o.isServerOnly}}}),{loading:"Saving...",success:"Saved!",error:"Failed to save."})}}})})]})},W=e=>{switch(e.type){case"textfield":return n.jsx(z,{...e});case"textarea":return n.jsx(G,{...e});case"checkbox":return n.jsx(J,{...e});case"select":return n.jsx(Z,{...e});case"custom":return n.jsx(H,{...e})}},h=2e3,z=e=>{const{register:t,handleSubmit:a,watch:u,formState:i,resetField:s}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),o=u(e.settingProps.name),[,,r]=P({value:o,isDirty:i.isDirty,isValid:i.isValid},h,({value:l,isDirty:g,isValid:c})=>{!c||!g||e.settingProps.onUpdate(l)}),d=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return m.useEffect(()=>{i.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:a(d),children:[n.jsx(L,{...e,type:e.inputType??(e.isSecret?"password":"text"),description:e.description&&n.jsx(v,{children:e.description}),...t(e.settingProps.name,e.registerOptions),error:i.errors[e.settingProps.name],className:O(!e.fullWidth&&"max-w-sm",e.className)}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},G=e=>{const{register:t,handleSubmit:a,watch:u,formState:i,resetField:s}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),o=u(e.settingProps.name),[,,r]=P({value:o,isDirty:i.isDirty,isValid:i.isValid},h,({value:l,isDirty:g,isValid:c})=>{!c||!g||e.settingProps.onUpdate(l)}),d=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return m.useEffect(()=>{i.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:a(d),children:[n.jsx($,{...e,description:e.description&&n.jsx(v,{children:e.description}),...t(e.settingProps.name,e.registerOptions),error:i.errors[e.settingProps.name]}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},J=e=>{const{control:t,handleSubmit:a,watch:u,formState:i,resetField:s}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),o=u(e.settingProps.name),[,,r]=P({value:o,isDirty:i.isDirty,isValid:i.isValid},h,({value:l,isValid:g,isDirty:c})=>{!g||!c||e.settingProps.onUpdate(l)}),d=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return m.useEffect(()=>{i.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:a(d),className:"flex flex-col items-start gap-1",children:[n.jsx("div",{className:"text-foreground-900 text-base font-medium",children:e.title}),e.description&&n.jsx(v,{children:e.description}),n.jsx(C,{...e,name:e.settingProps.name,control:t,checkboxProps:{...e.checkboxProps,label:e.label},error:i.errors[e.settingProps.name]}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},Z=e=>{const{control:t,handleSubmit:a,formState:u,watch:i,resetField:s}=f({mode:"onChange",defaultValues:{[e.settingProps.name]:e.settingProps.value}}),o=i(e.settingProps.name),[,,r]=P({value:o,isDirty:u.isDirty,isValid:u.isValid},h,({value:l,isDirty:g,isValid:c})=>{!c||!g||e.settingProps.onUpdate(l)}),d=l=>{r(),e.settingProps.onUpdate(l[e.settingProps.name])};return m.useEffect(()=>{u.isDirty&&s(e.settingProps.name,{defaultValue:e.settingProps.value})},[e.settingProps.value]),n.jsxs("form",{onSubmit:a(d),children:[n.jsxs(E,{...e,name:e.settingProps.name,control:t,error:u.errors[e.settingProps.name],children:[n.jsx(T,{className:"max-w-xs",children:e.placeholder}),n.jsx(B,{children:e.options.map(l=>n.jsx(_,{value:l.value,children:l.label},JSON.stringify(l.value)))})]}),e.settingProps.updatedAt&&n.jsxs("div",{className:"text-foreground-700 text-sm",children:["Last updated: ",S(e.settingProps.updatedAt).fromNow()]})]})},H=e=>{const t=e.render;return n.jsx(t,{onUpdate:e.settingProps.onUpdate,value:e.settingProps.value})};export{Y as default};
